name: Lint
description: Run cargo fmt, clippy, test

runs:
  using: 'composite'
  steps:
    - name: taplo fmt check
      shell: bash
      run: |
        curl -fsSL https://github.com/tamasfe/taplo/releases/latest/download/taplo-full-linux-x86_64.gz | gzip -d - | install -m 755 /dev/stdin /usr/local/bin/taplo
        taplo fmt --check
        taplo check

    - name: cargo fmt
      shell: bash
      run: |
        cargo fmt --check

    - name: cargo clippy
      shell: bash
      run: |
        cargo clippy \
          --workspace \
          --exclude integration-tests \
          --locked \
          --all-targets \
          --tests -- -D warnings
